<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>React的PubSub机制</title>
      <link href="2021/03/18/React%E7%9A%84PubSub%E6%9C%BA%E5%88%B6/"/>
      <url>2021/03/18/React%E7%9A%84PubSub%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="React使用PubSub事件订阅，组件间通信"><a href="#React使用PubSub事件订阅，组件间通信" class="headerlink" title="React使用PubSub事件订阅，组件间通信"></a>React使用PubSub事件订阅，组件间通信</h1><h2 id="1-官网：https-github-com-mroderick-PubSubJS"><a href="#1-官网：https-github-com-mroderick-PubSubJS" class="headerlink" title="1.官网：https://github.com/mroderick/PubSubJS"></a>1.官网：<a href="https://github.com/mroderick/PubSubJS">https://github.com/mroderick/PubSubJS</a></h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h3><p>​    <a href="https://github.com/mroderick/PubSubJS">PubSub</a>，一个利用JavaScript进行发布/订阅的库，</p><p>为了方便在模块化开发当中进行各个模块的数据传递，所以引入了PubSub.js库。</p><h3 id="2-消息订阅与发布机制"><a href="#2-消息订阅与发布机制" class="headerlink" title="2.消息订阅与发布机制"></a>2.消息订阅与发布机制</h3><pre><code>               1.先订阅，再发布（理解：有一种隔空对话的感觉）              2.适用于任意组件间通信                        3.要在组件的componentWillUnmount中取消订阅</code></pre><h2 id="2-PubSub安装"><a href="#2-PubSub安装" class="headerlink" title="2.PubSub安装"></a>2.PubSub安装</h2><h3 id="1-下载依赖包"><a href="#1-下载依赖包" class="headerlink" title="1.下载依赖包"></a>1.下载依赖包</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install pubsub-js </span><br><span class="line"><span class="comment">//or</span></span><br><span class="line">yarn add pubsub-js</span><br></pre></td></tr></table></figure><h3 id="2-使用外链引用"><a href="#2-使用外链引用" class="headerlink" title="2.使用外链引用"></a>2.使用外链引用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//www.jsdelivr.com/#!pubsubjs</span></span><br><span class="line">https:<span class="comment">//cdnjs.com/libraries/pubsub-js</span></span><br><span class="line">https:<span class="comment">//unpkg.com/pubsub-js</span></span><br></pre></td></tr></table></figure><h3 id="3-在组件中导入"><a href="#3-在组件中导入" class="headerlink" title="3.在组件中导入"></a>3.在组件中导入</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">&#x27;pubsub-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// or when using CommonJS</span></span><br><span class="line"><span class="keyword">const</span> PubSub = <span class="built_in">require</span>(<span class="string">&#x27;pubsub-js&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="4-使用PubSub"><a href="#4-使用PubSub" class="headerlink" title="4.使用PubSub"></a>4.使用PubSub</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消息发布：传递两个参数一个是接受函数的名字，一个给接受函数传递的参数</span></span><br><span class="line">  PubSub.publish(<span class="string">&#x27;fnName&#x27;</span>,data)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消息订阅：函数接受  使用一个变量token去接收,传递两个参数，一个是定义的函数名字，一个是接收的函数（接收函数里面的msg可以忽略，data就是传递过来的值）；</span></span><br><span class="line"><span class="comment">//emmm，感觉和vuex有类似的地方</span></span><br><span class="line">   <span class="built_in">this</span>.token = PubSub.subscribe(<span class="string">&#x27;fnName&#x27;</span>, <span class="function">(<span class="params">msg, data</span>) =&gt;</span> &#123;</span><br><span class="line">             <span class="built_in">console</span>.log(data);</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><h3 id="5-案例"><a href="#5-案例" class="headerlink" title="5.案例"></a>5.案例</h3><p>​            在要使用的组件引入：**import PubSub from ‘pubsub-js’ ** ，然后在父组件的componentWillMount钩子进行消息的订阅。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Bar <span class="keyword">from</span> <span class="string">&#x27;./components/Bar&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">&#x27;pubsub-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      msg:<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">componentWillMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 订阅消息</span></span><br><span class="line">    PubSub.subscribe(<span class="string">&#x27;msg&#x27;</span>,<span class="function">(<span class="params">msg,data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        msg:data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;msg&#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Bar/&gt;</span><br><span class="line">        &lt;p style=&#123;&#123;<span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>&#125;&#125;&gt;我是订阅的结果：&#123;msg&#125;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​            在子组件/(兄弟组件)中进行发布消息，毕竟有了快递包裹的发件人，( •̀ ω •́ )y一定会有接受包裹的收件人。在这里我就以子组件为例子。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">&#x27;pubsub-js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  sendMsg = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 发布消息</span></span><br><span class="line">    PubSub.publish(<span class="string">&#x27;msg&#x27;</span>,<span class="string">`我是发布的随机数：<span class="subst">$&#123;<span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random()*<span class="number">1000</span>)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.sendMsg&#125;&gt;发布消息&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PubSub </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
